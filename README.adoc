= Kaocha plugin `test-ns-hook`
:sectnums:

* Kaocha plugin `test-ns-hook` for `test-ns-hook` feature in clojure.test`


== How to install

To include this plugin for kaocha in your project, simply add the following to your
`project.clj` dependencies:

[listing]
----
[philoskim/test-ns-hook "0.1.0"]
----


== Use example

[listing]
----
;; project.clj for lein
(defproject my-project "0.1.0"
  :dependencies [[org.clojure/clojure "1.11.1" :scope "provided"]
                 [lambdaisland/kaocha "1.87.1366"]
                 [philoskim/test-ns-hook "0.1.0"]]
  :aliases {"unit-test" ["run" "-m" "kaocha.runner" ":unit"]})
----


[listing]
----
;; tests.edn for Kaocha
{:kaocha/tests
 [{:kaocha.testable/type :kaocha.type/clojure.test,
   :kaocha.testable/id :unit,
   :kaocha/ns-patterns ["-test$"],
   :kaocha/source-paths ["src"],
   :kaocha/test-paths ["test"],
   :kaocha.filter/skip-meta [:kaocha/skip]}]
 :kaocha/fail-fast? false,
 :kaocha/color? true,
 :kaocha/cli-options {:config-file "tests.edn", :print-config true},
 :kaocha.plugin.randomize/randomize? false,
 :kaocha/plugins [:kaocha.plugin/filter
                  :philoskim.kaocha.plugin/test-ns-hook],
 :kaocha.plugin.capture-output/capture-output? false,
 :kaocha/reporter [kaocha.report/dots]}
----


[listing]
----
;; test/my-test
(ns my-test
  (:require [clojure.test :refer :all]))

(use 'debux.core)

(defn my-test-fixture [f]
  (print "start fixture")
  (f)
  (print "end fixture"))

(use-fixtures :once my-test-fixture)


(deftest test-a
  (testing "test-a"
    (is (= 1 1))
    (is (= (+ 2 2) 5)) ))

(deftest test-b
  (testing "test-b"
    (is (= 10 10))
    (is (= 20 20))))

(defn test-ns-hook []
  (test-a)
  (test-b))
----


[listing]
----
$ lein unit-test
[(.F..)]

FAIL in my-test/test-ns-str (my_test.clj:15)
test-a
Expected:
  4
Actual:
  -4 +5
1 tests, 4 assertions, 1 failures.
----


